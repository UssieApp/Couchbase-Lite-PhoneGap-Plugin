{
  "CBLite:info": {
    "disk_size": 187992,
    "db_uuid": "9e6f2209-1bcc-4e8d-847b-0741acc104f0",
    "db_name": "s2-tom-2017040404",
    "update_seq": 15,
    "instance_start_time": 1491345745538000,
    "doc_count": 11
  },
  "CBLite:design:get": {
    "language": "javascript",
    "version": 2016062103,
    "views": {
      "friend": {
        "map": "function(doc) { switch (doc.type) { case 'link': var friend; var keys = Object.keys(doc.map); for (var k in keys) { var key = keys[k]; if (key != 'tom.2017040404') { if (doc.map[key].status < 0) { return; } } else { friend = doc.map[key]; } } if (friend) { emit(friend.id, { threadId: doc._id, status: friend.status, isFlagged: !!(friend.flags && friend.flags['tom.2017040404']) }); } break; case 'user': var user = { name: doc.name, username: doc.username, avatarId: doc.avatarId }; if (doc.username == 'tom.2017040404') { user.isMe = true; } emit(doc.username, user); break; } }",
        "notes": "does a join of link and user records, and keys by username",
        "reduce": "function(key, vals) { if (vals.length != 2) { return vals[0]; } var l = (vals[0].threadId) ? vals[0] : vals[1]; var u = (vals[0].threadId) ? vals[1] : vals[0]; return { username: u.username, threadId: l.threadId, status: l.status, isFlagged: l.isFlagged, name: u.name, avatarId: u.avatarId, tagline: u.tagline }; }"
      },
      "members": {
        "map": "function(doc) { if (doc.type == 'group') { if (doc.members) { for (var i in doc.members) { emit(doc.members[i], true); } } if (doc.inactive) { for (var i in doc.inactive) { emit(doc.inactive[i], false); } } } }",
        "notes": "lists groups my member username"
      },
      "thread": {
        "map": "function(doc){switch(doc.type){case 'card':emit([doc.threadId,doc.uid],{cardId:doc._id,latest:doc.created});break;case 'comment':emit([doc.threadId,doc.cardId],{cardId:'card:'+doc.cardId,latest:doc.created});break;case 'seen':emit([doc.threadId,doc.cardId],{seenAt:doc.at,seen:doc.count});break;}}",
        "notes": "creates a [threadId, cardId] index. query with group_level = 1 to get the latest cardId, group_level 2 to get all the cardIds",
        "reduce": "function(key,values){var out={cardId:'',latest:'',count:0,seenAt:'',seen:0};for(var i=0;i<values.length;i++){var v=values[i];if(v.latest){out.count++;if(v.latest>out.latest){out.latest=v.latest;out.cardId=v.cardId;}if(!out.cardId){out.cardId=v.cardId;}}if(v.seenAt&&v.seenAt>out.seenAt){out.seenAt=v.seenAt;}if(v.seen){out.seen+=v.seen;}}return out;}"
      }
    },
    "_rev": "1-269cdf7226f9a70f5c5cdcf46942a6ed",
    "_id": "_design/messages"
  },
  "CBLite:design:view": [
    {
      "total_rows": 3,
      "offset": 0,
      "rows": [
        {
          "doc": null,
          "id": null,
          "key": "tom.2017040404",
          "value": {
            "name": "tom.2017040404",
            "username": "tom.2017040404",
            "avatarId": "00000000-0000-f000-b000-000000000074",
            "isMe": true
          }
        },
        {
          "doc": null,
          "id": null,
          "key": "Ussie",
          "value": {
            "username": "Ussie",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "status": 0,
            "isFlagged": false,
            "name": "Team Ussie",
            "avatarId": "00000000-0000-f000-a000-000000000003",
            "tagline": null
          }
        }
      ]
    },
    {
      "total_rows": 3,
      "offset": 0,
      "rows": []
    },
    {
      "total_rows": 7,
      "offset": 0,
      "rows": [
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "10e12401-61d2-4f73-83d8-111a886af19a"
          ],
          "value": {
            "cardId": "card:10e12401-61d2-4f73-83d8-111a886af19a",
            "latest": "2017-04-04T21:23:29.155779105Z",
            "count": 1,
            "seenAt": "",
            "seen": 0
          }
        },
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab"
          ],
          "value": {
            "cardId": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "latest": "2017-04-04T21:23:29.144421558Z",
            "count": 1,
            "seenAt": "",
            "seen": 0
          }
        },
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "eafcdd7a-09bb-4497-b208-a2b07ef0ae66"
          ],
          "value": {
            "cardId": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "latest": "2017-04-04T22:32:07.238Z",
            "count": 4,
            "seenAt": "2017-04-04T22:32:07.238Z",
            "seen": 4
          }
        }
      ]
    },
    {
      "total_rows": 8,
      "offset": 0,
      "rows": [
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "10e12401-61d2-4f73-83d8-111a886af19a"
          ],
          "value": {
            "cardId": "card:10e12401-61d2-4f73-83d8-111a886af19a",
            "latest": "2017-04-04T21:23:29.155779105Z",
            "count": 1,
            "seenAt": "2017-04-04T21:23:29.155779105Z",
            "seen": 1
          }
        },
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab"
          ],
          "value": {
            "cardId": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "latest": "2017-04-04T21:23:29.144421558Z",
            "count": 1,
            "seenAt": "",
            "seen": 0
          }
        },
        {
          "doc": null,
          "id": null,
          "key": [
            "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "eafcdd7a-09bb-4497-b208-a2b07ef0ae66"
          ],
          "value": {
            "cardId": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "latest": "2017-04-04T22:32:07.238Z",
            "count": 4,
            "seenAt": "2017-04-04T22:32:07.238Z",
            "seen": 4
          }
        }
      ]
    }
  ],
  "CBLite:all": [
    {
      "total_rows": 1,
      "offset": 0,
      "rows": [
        {
          "doc": {
            "_rev": "1-4dc771829a26db482376b495fb8d30a5",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000004",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.161736865Z",
            "uid": "eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "_id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "type": "card",
            "created": "2017-04-04T21:23:29.161736865Z",
            "caption": "Hi!",
            "author": "Ussie"
          },
          "id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "key": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "value": {
            "_conflicts": [],
            "rev": "1-4dc771829a26db482376b495fb8d30a5"
          }
        }
      ]
    },
    {
      "total_rows": 3,
      "offset": 0,
      "rows": [
        {
          "doc": {
            "_rev": "1-8b3904fb6a2d87c101d2ba71ad32ed3e",
            "imageId": "00000000-0000-f000-a000-000000000007",
            "cardType": "page",
            "data": {
              "title": "Teach Me How To Ussie",
              "url": "http://www.ussie.rocks/teachme"
            },
            "updated": "2017-04-04T21:23:29.155779105Z",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "uid": "10e12401-61d2-4f73-83d8-111a886af19a",
            "_id": "card:10e12401-61d2-4f73-83d8-111a886af19a",
            "type": "card",
            "created": "2017-04-04T21:23:29.155779105Z",
            "caption": "Tap the photo to open the link!",
            "author": "Ussie"
          },
          "id": "card:10e12401-61d2-4f73-83d8-111a886af19a",
          "key": "card:10e12401-61d2-4f73-83d8-111a886af19a",
          "value": {
            "_conflicts": [],
            "rev": "1-8b3904fb6a2d87c101d2ba71ad32ed3e"
          }
        },
        {
          "doc": {
            "_rev": "1-5cb0af2a8980ba4bb764863ed6386f09",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000008",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.144421558Z",
            "uid": "d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "_id": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "type": "card",
            "created": "2017-04-04T21:23:29.144421558Z",
            "caption": "Made with ðŸ’› in NYC",
            "author": "Ussie"
          },
          "id": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
          "key": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
          "value": {
            "_conflicts": [],
            "rev": "1-5cb0af2a8980ba4bb764863ed6386f09"
          }
        },
        {
          "doc": {
            "_rev": "1-4dc771829a26db482376b495fb8d30a5",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000004",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.161736865Z",
            "uid": "eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "_id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "type": "card",
            "created": "2017-04-04T21:23:29.161736865Z",
            "caption": "Hi!",
            "author": "Ussie"
          },
          "id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "key": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "value": {
            "_conflicts": [],
            "rev": "1-4dc771829a26db482376b495fb8d30a5"
          }
        }
      ]
    },
    {
      "total_rows": 3,
      "offset": 0,
      "rows": [
        {
          "doc": {
            "_rev": "1-8b3904fb6a2d87c101d2ba71ad32ed3e",
            "imageId": "00000000-0000-f000-a000-000000000007",
            "cardType": "page",
            "data": {
              "title": "Teach Me How To Ussie",
              "url": "http://www.ussie.rocks/teachme"
            },
            "updated": "2017-04-04T21:23:29.155779105Z",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "uid": "10e12401-61d2-4f73-83d8-111a886af19a",
            "_id": "card:10e12401-61d2-4f73-83d8-111a886af19a",
            "type": "card",
            "created": "2017-04-04T21:23:29.155779105Z",
            "caption": "Tap the photo to open the link!",
            "author": "Ussie"
          },
          "id": "card:10e12401-61d2-4f73-83d8-111a886af19a",
          "key": "card:10e12401-61d2-4f73-83d8-111a886af19a",
          "value": {
            "_conflicts": [],
            "rev": "1-8b3904fb6a2d87c101d2ba71ad32ed3e"
          }
        },
        {
          "doc": {
            "_rev": "1-5cb0af2a8980ba4bb764863ed6386f09",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000008",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.144421558Z",
            "uid": "d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "_id": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
            "type": "card",
            "created": "2017-04-04T21:23:29.144421558Z",
            "caption": "Made with ðŸ’› in NYC",
            "author": "Ussie"
          },
          "id": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
          "key": "card:d22ab5b8-a68b-4fd2-a402-7bf5fbf4ebab",
          "value": {
            "_conflicts": [],
            "rev": "1-5cb0af2a8980ba4bb764863ed6386f09"
          }
        },
        {
          "doc": {
            "_rev": "1-4dc771829a26db482376b495fb8d30a5",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000004",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.161736865Z",
            "uid": "eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "_id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "type": "card",
            "created": "2017-04-04T21:23:29.161736865Z",
            "caption": "Hi!",
            "author": "Ussie"
          },
          "id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "key": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "value": {
            "_conflicts": [],
            "rev": "1-4dc771829a26db482376b495fb8d30a5"
          }
        }
      ]
    },
    {
      "total_rows": 1,
      "offset": 0,
      "rows": [
        {
          "doc": {
            "_rev": "1-4dc771829a26db482376b495fb8d30a5",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "imageId": "00000000-0000-f000-a000-000000000004",
            "cardType": "image",
            "updated": "2017-04-04T21:23:29.161736865Z",
            "uid": "eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "_id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
            "type": "card",
            "created": "2017-04-04T21:23:29.161736865Z",
            "caption": "Hi!",
            "author": "Ussie"
          },
          "id": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "key": "card:eafcdd7a-09bb-4497-b208-a2b07ef0ae66",
          "value": {
            "_conflicts": [],
            "rev": "1-4dc771829a26db482376b495fb8d30a5"
          }
        }
      ]
    }
  ],
  "CBLite:replicate:to": {
    "session_id": "repl001",
    "ok": true
  },
  "CBLite:replicate:from": {
    "session_id": "repl002",
    "ok": true
  },
  "CBLite:changes": [
    {
      "last_seq": 15,
      "results": []
    },
    {
      "last_seq": 16,
      "results": [
        {
          "seq": 16,
          "doc": {
            "_rev": "1-8fa7441b99fe9c56ccee0ee7cb46d635",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "at": "2017-04-04T21:23:29.155779105Z",
            "updated": "2017-04-04T22:43:09.270Z",
            "count": 1,
            "cardId": "10e12401-61d2-4f73-83d8-111a886af19a",
            "_id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
            "type": "seen",
            "owner": "tom.2017040404",
            "created": "2017-04-04T22:43:09.270Z",
            "flag": false
          },
          "id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
          "changes": [
            {
              "rev": "1-8fa7441b99fe9c56ccee0ee7cb46d635"
            }
          ]
        }
      ]
    },
    {
      "last_seq": 17,
      "results": [
        {
          "seq": 17,
          "doc": {
            "_rev": "2-463d8fb180d6d519461c399ce967cd18",
            "threadId": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130",
            "at": "2017-04-04T21:23:29.155779105Z",
            "updated": "2017-04-04T22:43:11.068Z",
            "count": 1,
            "cardId": "10e12401-61d2-4f73-83d8-111a886af19a",
            "_id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
            "type": "seen",
            "owner": "tom.2017040404",
            "created": "2017-04-04T22:43:09.270Z",
            "flag": false
          },
          "id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
          "changes": [
            {
              "rev": "2-463d8fb180d6d519461c399ce967cd18"
            }
          ]
        }
      ]
    }
  ],
  "CBLite:doc:load": [
    {
      "avatarId": "00000000-0000-f000-a000-000000000003",
      "created": "2015-09-29T00:00:00.0Z",
      "name": "Team Ussie",
      "type": "user",
      "uid": "ussie",
      "updated": "2015-09-29T00:00:00.0Z",
      "username": "Ussie",
      "_rev": "3-955861a1abad453deec3bcca193d2816",
      "_id": "user:ussie"
    },
    {
      "created": "2017-04-04T21:23:29.039635257Z",
      "linkTypes": [
        "system"
      ],
      "map": {
        "Ussie": {
          "id": "tom.2017040404",
          "status": 1
        },
        "tom.2017040404": {
          "id": "Ussie",
          "status": 0
        }
      },
      "type": "link",
      "uid": "cacb0fd2-85bb-320a-8b1d-a53d04abc130",
      "updated": "2017-04-04T21:23:29.039635257Z",
      "_rev": "1-88785e33e15086761bae887dbab0722c",
      "_id": "link:cacb0fd2-85bb-320a-8b1d-a53d04abc130"
    }
  ],
  "CBLite:doc:save": [
    {
      "rev": "1-8fa7441b99fe9c56ccee0ee7cb46d635",
      "id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
      "ok": true
    },
    {
      "rev": "2-463d8fb180d6d519461c399ce967cd18",
      "id": "seen:tom.2017040404:link:cacb0fd2-85bb-320a-8b1d-a53d04abc130:10e12401-61d2-4f73-83d8-111a886af19a",
      "ok": true
    }
  ]
}